import{n as c,I as d,i as m,L as n,M as h}from"./index-9e6d23c1.js";var u=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"api-detail-container"},[e("div",{staticClass:"api-header"},[e("t-button",{staticClass:"back-btn",attrs:{theme:"default",variant:"text"},on:{click:function(a){return t.$router.back()}}},[e("t-icon",{attrs:{name:"left"}}),t._v("返回系统详情 ")],1),e("div",{staticClass:"api-title-section"},[e("h1",{staticClass:"api-title"},[t._v(t._s(t.apiInfo.name))]),e("div",{staticClass:"api-meta"},[e("span",{staticClass:"api-method",class:t.apiInfo.method},[t._v(t._s(t.apiInfo.method))]),e("span",{staticClass:"api-path"},[t._v(t._s(t.apiInfo.path))]),e("span",{staticClass:"api-status",class:{active:t.apiInfo.status==="active"}},[t._v(" "+t._s(t.apiInfo.status==="active"?"活跃":"停用")+" ")])])])],1),e("div",{staticClass:"tab-container"},[e("t-tabs",{staticClass:"api-tabs",model:{value:t.activeTab,callback:function(a){t.activeTab=a},expression:"activeTab"}},[e("t-tab-panel",{attrs:{value:"call",label:"调用模块"}},[e("div",{staticClass:"call-module"},[e("div",{staticClass:"api-basic-info"},[e("h2",[t._v("API基本信息")]),e("div",{staticClass:"info-grid"},[e("div",{staticClass:"info-item"},[e("label",[t._v("接口名称")]),e("span",[t._v(t._s(t.apiInfo.name))])]),e("div",{staticClass:"info-item"},[e("label",[t._v("请求方法")]),e("span",{staticClass:"method-tag",class:t.apiInfo.method},[t._v(t._s(t.apiInfo.method))])]),e("div",{staticClass:"info-item"},[e("label",[t._v("接口路径")]),e("code",{staticClass:"api-path"},[t._v(t._s(t.apiInfo.path))])]),e("div",{staticClass:"info-item"},[e("label",[t._v("状态")]),e("span",{staticClass:"status-tag",class:{active:t.apiInfo.status==="active"}},[t._v(" "+t._s(t.apiInfo.status==="active"?"活跃":"停用")+" ")])]),e("div",{staticClass:"info-item"},[e("label",[t._v("创建时间")]),e("span",[t._v(t._s(t.apiInfo.createTime||"2024-01-01"))])]),e("div",{staticClass:"info-item"},[e("label",[t._v("最后更新")]),e("span",[t._v(t._s(t.apiInfo.updateTime||"2024-12-08"))])])])]),e("div",{staticClass:"request-params"},[e("h2",[t._v("请求参数")]),e("t-table",{attrs:{columns:t.paramColumns,data:t.apiInfo.params||[],"row-key":"index"},scopedSlots:t._u([{key:"required",fn:function(a){var i=a.row;return[i.required?e("t-tag",{attrs:{theme:"danger",variant:"light"}},[t._v("必选")]):e("t-tag",{attrs:{theme:"default",variant:"light"}},[t._v("可选")])]}},{key:"type",fn:function(a){var i=a.row;return[e("code",[t._v(t._s(i.type))])]}}])})],1),e("div",{staticClass:"response-example"},[e("h2",[t._v("响应示例")]),e("div",{staticClass:"code-block"},[e("pre",[e("code",[t._v(t._s(t.formatResponseExample(t.apiInfo.responseExample)))])])])]),e("div",{staticClass:"api-test"},[e("h2",[t._v("API调用测试")]),e("div",{staticClass:"test-panel"},[e("div",{staticClass:"test-controls"},[e("t-button",{attrs:{loading:t.testing},on:{click:t.testApiCall}},[e("t-icon",{attrs:{name:"play-circle"}}),t._v("测试调用 ")],1),e("t-button",{attrs:{variant:"outline"},on:{click:t.resetTest}},[t._v("重置")])],1),t.testResult?e("div",{staticClass:"test-result"},[e("h3",[t._v("测试结果")]),e("div",{staticClass:"result-info"},[e("div",{staticClass:"result-item"},[e("label",[t._v("状态码:")]),e("span",{class:{success:t.testResult.status===200,error:t.testResult.status>=400}},[t._v(" "+t._s(t.testResult.status)+" ")])]),e("div",{staticClass:"result-item"},[e("label",[t._v("响应时间:")]),e("span",[t._v(t._s(t.testResult.duration)+"ms")])]),e("div",{staticClass:"result-item"},[e("label",[t._v("响应数据:")]),e("pre",{staticClass:"response-data"},[t._v(t._s(JSON.stringify(t.testResult.data,null,2)))])])])]):t._e()])])])]),e("t-tab-panel",{attrs:{value:"monitor",label:"检测模块"}},[e("div",{staticClass:"monitor-module"},[e("div",{staticClass:"monitoring-panel"},[e("div",{staticClass:"section-header"},[e("h2",[t._v("实时监测")]),e("div",{staticClass:"monitoring-controls"},[e("t-button-group",[e("t-button",{attrs:{variant:t.timeRange==="1h"?"base":"outline"},on:{click:function(a){return t.changeTimeRange("1h")}}},[t._v(" 1小时 ")]),e("t-button",{attrs:{variant:t.timeRange==="6h"?"base":"outline"},on:{click:function(a){return t.changeTimeRange("6h")}}},[t._v(" 6小时 ")]),e("t-button",{attrs:{variant:t.timeRange==="24h"?"base":"outline"},on:{click:function(a){return t.changeTimeRange("24h")}}},[t._v(" 24小时 ")])],1),e("t-switch",{attrs:{label:["自动刷新"]},model:{value:t.autoRefresh,callback:function(a){t.autoRefresh=a},expression:"autoRefresh"}}),e("t-button",{attrs:{loading:t.refreshing},on:{click:t.refreshData}},[e("t-icon",{attrs:{name:"refresh"}}),t._v("刷新 ")],1)],1)]),e("div",{staticClass:"metrics-grid"},[e("div",{staticClass:"metric-card"},[e("div",{staticClass:"metric-icon success"},[e("t-icon",{attrs:{name:"check-circle"}})],1),e("div",{staticClass:"metric-content"},[e("div",{staticClass:"metric-value"},[t._v(t._s(t.realTimeData.successRate)+"%")]),e("div",{staticClass:"metric-label"},[t._v("成功率")]),e("div",{staticClass:"metric-trend",class:{up:t.realTimeData.successRateTrend>0,down:t.realTimeData.successRateTrend<0}},[t._v(" "+t._s(t.realTimeData.successRateTrend>0?"+":"")+t._s(t.realTimeData.successRateTrend)+"% ")])])]),e("div",{staticClass:"metric-card"},[e("div",{staticClass:"metric-icon warning"},[e("t-icon",{attrs:{name:"time"}})],1),e("div",{staticClass:"metric-content"},[e("div",{staticClass:"metric-value"},[t._v(t._s(t.realTimeData.avgResponseTime)+"ms")]),e("div",{staticClass:"metric-label"},[t._v("平均响应时间")]),e("div",{staticClass:"metric-trend",class:{up:t.realTimeData.responseTimeTrend>0,down:t.realTimeData.responseTimeTrend<0}},[t._v(" "+t._s(t.realTimeData.responseTimeTrend>0?"+":"")+t._s(t.realTimeData.responseTimeTrend)+"ms ")])])]),e("div",{staticClass:"metric-card"},[e("div",{staticClass:"metric-icon primary"},[e("t-icon",{attrs:{name:"rocket"}})],1),e("div",{staticClass:"metric-content"},[e("div",{staticClass:"metric-value"},[t._v(t._s(t.realTimeData.requestCount))]),e("div",{staticClass:"metric-label"},[t._v("请求量")]),e("div",{staticClass:"metric-trend",class:{up:t.realTimeData.requestTrend>0,down:t.realTimeData.requestTrend<0}},[t._v(" "+t._s(t.realTimeData.requestTrend>0?"+":"")+t._s(t.realTimeData.requestTrend)+" ")])])]),e("div",{staticClass:"metric-card"},[e("div",{staticClass:"metric-icon error"},[e("t-icon",{attrs:{name:"error-circle"}})],1),e("div",{staticClass:"metric-content"},[e("div",{staticClass:"metric-value"},[t._v(t._s(t.realTimeData.errorCount))]),e("div",{staticClass:"metric-label"},[t._v("错误数")]),e("div",{staticClass:"metric-trend",class:{up:t.realTimeData.errorTrend>0,down:t.realTimeData.errorTrend<0}},[t._v(" "+t._s(t.realTimeData.errorTrend>0?"+":"")+t._s(t.realTimeData.errorTrend)+" ")])])])]),e("div",{staticClass:"charts-section"},[e("div",{staticClass:"chart-container"},[e("h3",[t._v("响应时间趋势")]),e("div",{ref:"responseTimeChart",staticClass:"chart"})]),e("div",{staticClass:"chart-container"},[e("h3",[t._v("成功率趋势")]),e("div",{ref:"successRateChart",staticClass:"chart"})]),e("div",{staticClass:"chart-container"},[e("h3",[t._v("请求量分布")]),e("div",{ref:"requestChart",staticClass:"chart"})]),e("div",{staticClass:"chart-container"},[e("h3",[t._v("错误类型分布")]),e("div",{ref:"errorChart",staticClass:"chart"})])]),e("div",{staticClass:"data-stream"},[e("div",{staticClass:"section-header"},[e("h2",[t._v("实时数据流")])]),e("div",{staticClass:"stream-container"},t._l(t.realTimeStream,function(a){return e("div",{key:a.id,staticClass:"stream-item",class:a.type},[e("div",{staticClass:"stream-time"},[t._v(t._s(t.formatTime(a.timestamp)))]),e("div",{staticClass:"stream-content"},[e("span",{staticClass:"stream-method",class:a.method},[t._v(t._s(a.method))]),e("span",{staticClass:"stream-path"},[t._v(t._s(a.path))]),e("span",{staticClass:"stream-status",class:{success:a.status===200,error:a.status>=400}},[t._v(" "+t._s(a.status)+" ")]),e("span",{staticClass:"stream-duration"},[t._v(t._s(a.duration)+"ms")])])])}),0)]),e("div",{staticClass:"error-details"},[e("div",{staticClass:"section-header"},[e("h2",[t._v("错误详情")]),e("t-button",{on:{click:t.exportErrorReport}},[t._v("导出报告")])],1),e("div",{staticClass:"error-list"},t._l(t.errorDetails,function(a){return e("div",{key:a.id,staticClass:"error-item"},[e("div",{staticClass:"error-header"},[e("span",{staticClass:"error-code"},[t._v(t._s(a.code))]),e("span",{staticClass:"error-message"},[t._v(t._s(a.message))]),e("span",{staticClass:"error-count"},[t._v(t._s(a.count)+"次")])]),e("div",{staticClass:"error-info"},[e("span",{staticClass:"error-time"},[t._v("最近发生: "+t._s(t.formatTime(a.lastOccurred)))]),e("span",{staticClass:"error-rate"},[t._v("占比: "+t._s(a.percentage)+"%")])])])}),0)])])])])],1)],1)])},p=[];const v={name:"ApiDetail",components:{TIcon:d},data(){return{activeTab:"call",apiInfo:{name:"",method:"",path:"",status:"active",params:[],responseExample:null},paramColumns:[{title:"参数名",colKey:"name",width:120},{title:"类型",colKey:"type",width:100},{title:"是否必选",colKey:"required",width:100},{title:"描述",colKey:"description",width:200},{title:"示例值",colKey:"example",width:150}],testing:!1,testResult:null,timeRange:"1h",refreshing:!1,autoRefresh:!0,realTimeData:{successRate:0,successRateTrend:0,avgResponseTime:0,responseTimeTrend:0,requestCount:0,requestTrend:0,errorCount:0,errorTrend:0},realTimeStream:[],errorDetails:[],charts:{},refreshTimer:null}},watch:{activeTab(t){t==="monitor"&&this.$nextTick(()=>{setTimeout(()=>{this.initCharts()},100)})},timeRange(){this.loadMonitoringData()},autoRefresh(t){t?this.startAutoRefresh():this.stopAutoRefresh()}},mounted(){this.loadApiInfo(),this.loadMonitoringData(),this.$nextTick(()=>{setTimeout(()=>{this.initCharts()},100)}),this.startAutoRefresh(),window.addEventListener("resize",this.handleResize)},beforeDestroy(){this.stopAutoRefresh(),Object.values(this.charts).forEach(t=>t&&t.dispose()),window.removeEventListener("resize",this.handleResize)},methods:{loadApiInfo(){const t=this.$route.query.apiId;this.$route.query.systemType;const s={"emp-list":{name:"获取员工列表",method:"GET",path:"/api/employees",status:"active",params:[{name:"page",type:"number",required:!1,description:"页码",example:"1"},{name:"size",type:"number",required:!1,description:"每页大小",example:"20"},{name:"keyword",type:"string",required:!1,description:"搜索关键词",example:"张三"}],responseExample:{code:200,message:"success",data:{total:100,list:[{id:1,name:"张三",department:"技术部",position:"工程师"},{id:2,name:"李四",department:"产品部",position:"产品经理"}]}}},"emp-create":{name:"创建新员工",method:"POST",path:"/api/employees",status:"active",params:[{name:"name",type:"string",required:!0,description:"员工姓名",example:"王五"},{name:"department",type:"string",required:!0,description:"部门",example:"技术部"},{name:"position",type:"string",required:!0,description:"职位",example:"工程师"}],responseExample:{code:200,message:"success",data:{id:123,name:"王五",department:"技术部",position:"工程师"}}}};this.apiInfo=s[t]||{name:"未知API",method:"GET",path:"/api/unknown",status:"inactive",params:[],responseExample:null}},formatResponseExample(t){return t?JSON.stringify(t,null,2):"暂无示例数据"},testApiCall(){this.testing=!0,setTimeout(()=>{this.testResult={status:200,duration:Math.floor(Math.random()*200)+50,data:this.apiInfo.responseExample||{code:200,message:"success",data:{}}},this.testing=!1},1e3)},resetTest(){this.testResult=null},initCharts(){["responseTimeChart","successRateChart","requestChart","errorChart"].forEach(s=>{const e=this.$refs[s];if(e&&e instanceof HTMLElement){if(e.offsetWidth===0||e.offsetHeight===0){console.warn(`图表容器尺寸为0: ${s}`,e.offsetWidth,e.offsetHeight);return}this.charts[s]&&this.charts[s].dispose(),this.charts[s]=m(e),this.setChartOption(s),console.log(`图表初始化成功: ${s}`)}else console.warn(`图表容器未找到: ${s}`,e)})},updateCharts(){Object.keys(this.charts).forEach(t=>{this.charts[t]&&this.setChartOption(t)})},setChartOption(t){if(!this.charts[t]){console.warn(`图表实例未找到: ${t}`);return}const s=this.generateChartData(t),a={responseTimeChart:{title:{text:"响应时间趋势",left:"center",textStyle:{fontSize:14}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:s.xAxis,axisLabel:{fontSize:10}},yAxis:{type:"value",name:"响应时间(ms)",axisLabel:{fontSize:10}},series:[{data:s.series,type:"line",smooth:!0,symbol:"circle",symbolSize:4,itemStyle:{color:"#1890ff"},areaStyle:{color:new n(0,0,0,1,[{offset:0,color:"rgba(24, 144, 255, 0.3)"},{offset:1,color:"rgba(24, 144, 255, 0.1)"}])}}]},successRateChart:{title:{text:"成功率趋势",left:"center",textStyle:{fontSize:14}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:s.xAxis,axisLabel:{fontSize:10}},yAxis:{type:"value",name:"成功率(%)",max:100,min:0,axisLabel:{fontSize:10}},series:[{data:s.series.map(i=>Math.min(i*10,100)),type:"line",smooth:!0,symbol:"circle",symbolSize:4,itemStyle:{color:"#52c41a"},areaStyle:{color:new n(0,0,0,1,[{offset:0,color:"rgba(82, 196, 26, 0.3)"},{offset:1,color:"rgba(82, 196, 26, 0.1)"}])}}]},requestChart:{title:{text:"请求量分布",left:"center",textStyle:{fontSize:14}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:["GET","POST","PUT","DELETE","PATCH"],axisLabel:{fontSize:10}},yAxis:{type:"value",name:"请求量",axisLabel:{fontSize:10}},series:[{data:[1200,800,600,300,100],type:"bar",itemStyle:{color:new n(0,0,0,1,[{offset:0,color:"#1890ff"},{offset:1,color:"#36cfc9"}])}}]},errorChart:{title:{text:"错误类型分布",left:"center",textStyle:{fontSize:14}},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",right:10,top:"center",textStyle:{fontSize:10}},series:[{name:"错误类型",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:12,fontWeight:"bold"}},labelLine:{show:!1},data:[{value:35,name:"500错误",itemStyle:{color:"#ff4d4f"}},{value:25,name:"400错误",itemStyle:{color:"#fa8c16"}},{value:20,name:"401错误",itemStyle:{color:"#faad14"}},{value:15,name:"404错误",itemStyle:{color:"#fadb14"}},{value:5,name:"其他错误",itemStyle:{color:"#d9d9d9"}}]}]}}[t];a?(this.charts[t].setOption(a,!0),this.charts[t].resize()):console.warn(`未找到图表配置: ${t}`)},generateChartData(t){const e=[],a=[];for(let i=24-1;i>=0;i--){const l=new Date(Date.now()-i*60*60*1e3);e.push(l.getHours()+":00");let r=0;t==="responseTimeChart"?r=Math.random()*100+50:t==="successRateChart"?r=Math.random()*5+95:r=Math.random()*100+50,a.push(Math.round(r))}return{xAxis:e,series:a}},loadMonitoringData(){this.refreshing=!0,setTimeout(()=>{this.realTimeData={successRate:Math.random()*10+90,successRateTrend:Math.random()*4-2,avgResponseTime:Math.random()*200+100,responseTimeTrend:Math.random()*40-20,requestCount:Math.floor(Math.random()*1e3)+500,requestTrend:Math.floor(Math.random()*100)-50,errorCount:Math.floor(Math.random()*10),errorTrend:Math.floor(Math.random()*5)-2},this.updateRealTimeStream(),this.updateErrorDetails(),this.updateCharts(),this.refreshing=!1},500)},updateRealTimeStream(){const t=["GET","POST","PUT","DELETE"],s=[200,400,401,403,404,500,502,503],e={id:Date.now()+Math.floor(Math.random()*1e3),timestamp:new Date,method:t[Math.floor(Math.random()*t.length)],path:this.apiInfo.path,status:s[Math.floor(Math.random()*s.length)],duration:Math.floor(Math.random()*500)+50,type:Math.random()>.9?"error":"success"};this.realTimeStream||(this.realTimeStream=[]),this.realTimeStream.unshift(e),this.realTimeStream.length>50&&(this.realTimeStream=this.realTimeStream.slice(0,50))},updateErrorDetails(){this.errorDetails=[{id:1,code:500,message:"内部服务器错误",count:12,lastOccurred:new Date,percentage:35},{id:2,code:400,message:"请求参数错误",count:8,lastOccurred:new Date(Date.now()-3e5),percentage:23},{id:3,code:401,message:"未授权访问",count:5,lastOccurred:new Date(Date.now()-6e5),percentage:15},{id:4,code:404,message:"资源不存在",count:3,lastOccurred:new Date(Date.now()-9e5),percentage:9}]},changeTimeRange(t){this.timeRange=t},refreshData(){this.loadMonitoringData()},startAutoRefresh(){this.autoRefresh&&(this.refreshTimer=setInterval(()=>{this.loadMonitoringData()},5e3))},stopAutoRefresh(){this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=null)},formatTime(t){return new Date(t).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",second:"2-digit"})},exportErrorReport(){h.success("错误报告导出成功")},handleResize(){Object.values(this.charts).forEach(t=>{t&&t.resize()})}}},o={};var f=c(v,u,p,!1,_,"e060de9a",null,null);function _(t){for(let s in o)this[s]=o[s]}const T=function(){return f.exports}();export{T as default};
